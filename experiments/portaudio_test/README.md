# PortAudio

This folder contains small programs used to validate device discovery, stream configuration, and multi-channel recording with PortAudio.

## Structure

```
portaudio_test/
├── pa_devices.cpp          # List audio devices + indices + channel support
├── recorder.cpp            # Simple multi-channel recorder
├── recording_8ch.wav       # Example Output
└── README.md
```

## Files

### `pa_devices.cpp`
Lists available input/output devices and prints key properties (index, name, max input/output channels, default sample rate).

Use this first to find the correct device indices before running any other programs.

### `recorder.cpp`
Minimal recorder to confirm:
- multi-channel capture works (e.g., 8 channels)
- WAV export is correct (duration, sample rate, interleaving)
- no dropouts/overflows under basic load

### `recording_8ch.wav`
Example output generated by `recorder.cpp`.

## Build notes (Linux)

Tooling:
```bash
sudo apt update
sudo apt install -y build-essential pkg-config
```

Install dependency:
```bash
sudo apt install -y portaudio19-dev
```

Build:
```bash
g++ -O3 -std=c++17 pa_devices.cpp -o pa_devices \
  $(pkg-config --cflags --libs portaudio-2.0) -lm -pthread

g++ -O3 -std=c++17 recorder.cpp -o recorder \
  $(pkg-config --cflags --libs portaudio-2.0) -lm -pthread
```

Run:
```bash
./pa_devices

./recorder
```

### ALSA plughw note (troubleshooting)
If your device cannot do 48 kHz natively and you get error message: `Pa_OpenStream(in): Invalid sample rate (-9997)`, you must run with ALSA `plughw` conversion:
```bash
PA_ALSA_PLUGHW=1 ./<program_file>
```

## Expected Result
- `pa_devices` prints a device list where your USB interface appears with the expected channel counts.
- `recorder` produces an unprocessed WAV with the expected duration, sample rate, and channel count.
- Playing back or inspecting the WAV should show distinct channels (not duplicated/empty).